# Deployable Bundle: WebRTC Rooms (HTTPS + TURN) ‚Ä¢ Docker Compose

‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏°‡∏°‡∏≤‡πÉ‡∏´‡πâ:
- **app**: Node.js (Express + Socket.IO) ‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏•‡∏∞ signaling ‡∏ö‡∏ô‡∏û‡∏≠‡∏£‡πå‡∏ï 4000
- **caddy**: reverse proxy + **HTTPS ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥** (Let's Encrypt)
- **turn**: **coturn** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö NAT traversal (3478/5349)

> ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ù‡∏±‡πà‡∏á‡πÅ‡∏≠‡∏õ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `app/` (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏ö Login, Session ‡πÄ‡∏õ‡πá‡∏ô per-browser session, Owner-only Quiz, History ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á)

---

## 1) ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÇ‡∏î‡πÄ‡∏°‡∏ô
‡∏ï‡∏±‡πâ‡∏á A/AAAA record ‡πÉ‡∏´‡πâ `CADDY_DOMAIN` ‡∏ä‡∏µ‡πâ‡∏°‡∏≤‡∏ó‡∏µ‡πà IP ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (VPS)

## 2) ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ .env
‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å `.env.example` ‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô `.env` ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏Å‡πâ‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á:
```bash
cp .env.example .env
# ‡πÅ‡∏Å‡πâ:
# CADDY_DOMAIN=meet.yourdomain.com
# CADDY_EMAIL=you@yourdomain.com
# JWT_SECRET=‡∏™‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏¢‡∏≤‡∏ß‡πÜ
# TURN_REALM=yourdomain.com
# TURN_USER=appuser
# TURN_PASS=StrongRandomPassword123
```

## 3) ‡∏£‡∏±‡∏ô (Production)
‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Docker + Docker Compose ‡∏Å‡πà‡∏≠‡∏ô ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô:
```bash
docker compose up -d --build
```
‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà:
```
https://<CADDY_DOMAIN>
```
Caddy ‡∏à‡∏∞‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á TLS ‡πÉ‡∏´‡πâ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á DNS ‡πÑ‡∏ß‡πâ‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤)

> ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Firewall/UFW: ‡πÄ‡∏õ‡∏¥‡∏î‡∏û‡∏≠‡∏£‡πå‡∏ï 80/tcp, 443/tcp, 3478/5349 ‡∏ó‡∏±‡πâ‡∏á tcp/udp

## 4) ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ TURN ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î (‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå TURN ‡∏ô‡∏µ‡πâ)
‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ä‡πâ `stun:stun.l.google.com:19302` ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏à‡πÄ‡∏û‡∏¥‡πà‡∏° TURN ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏ô‡∏ù‡∏±‡πà‡∏á client (‡πÑ‡∏ü‡∏•‡πå `app/client/src/App.jsx`, ‡πÉ‡∏ô `new RTCPeerConnection({ iceServers: [...] })`):
```js
{ urls: 'turn:' + window.location.hostname + ':3478', username: 'appuser', credential: 'StrongRandomPassword123' }
```
> ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î TLS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö TURN ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ `turns:` ‡πÅ‡∏•‡∏∞‡∏û‡∏≠‡∏£‡πå‡∏ï 5349 ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏™‡πà cert/pkey ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `turn/turnserver.conf` (‡πÅ‡∏•‡∏∞ mount certs ‡πÄ‡∏Ç‡πâ‡∏≤ container)

## 5) ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏≠‡∏õ‡πÅ‡∏•‡πâ‡∏ß deploy ‡πÉ‡∏´‡∏°‡πà
‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ö‡πÉ‡∏ô `app/` ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏±‡∏ô:
```bash
docker compose up -d --build
```

## 6) ‡πÇ‡∏´‡∏°‡∏î Dev (‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ö‡∏ô‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï)
‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô dev ‡πÅ‡∏ö‡∏ö‡πÅ‡∏¢‡∏Å (‡πÑ‡∏°‡πà‡∏°‡∏µ HTTPS):
```bash
# ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡∏û‡∏±‡∏í‡∏ô‡∏≤
cd app/server && npm install && cp .env.example .env && npm run init:db && npm run dev
# ‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
cd app/client && npm install && cp .env.example .env && npm run dev
# ‡πÄ‡∏õ‡∏¥‡∏î http://localhost:5173
```
> ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ö‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏à‡∏∞‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á/‡πÑ‡∏°‡∏Ñ‡πå‡∏ö‡∏ô HTTP (‡∏ô‡∏≠‡∏Å localhost)

## Notes
- SQLite ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô volume `appdata` ‡∏Ç‡∏≠‡∏á Docker (‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠ container restart)
- ‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏¢‡∏≠‡∏∞/‡∏™‡πÄ‡∏Å‡∏•‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á: ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏¢‡πâ‡∏≤‡∏¢ DB ‡πÑ‡∏õ PostgreSQL ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î socket.io adapter (redis) + sticky session
- ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô `JWT_SECRET`, ‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™ TURN ‡πÉ‡∏´‡πâ‡πÄ‡∏î‡∏≤‡∏¢‡∏≤‡∏Å, ‡∏à‡∏≥‡∏Å‡∏±‡∏î CORS ‡πÉ‡∏ô `.env` ‡∏ù‡∏±‡πà‡∏á‡πÅ‡∏≠‡∏õ (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)

Good luck & have fun üöÄ
